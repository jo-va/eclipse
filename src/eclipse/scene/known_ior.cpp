#include "eclipse/scene/known_ior.h"

#include <map>
#include <string>
#include <locale>

namespace eclipse { namespace material {

namespace {

// Sourced from: http://forums.cgsociety.org/archive/index.php?t-513458.html
std::map<std::string, float> known_iors =
{
    { "Acetone",                 1.36  },
    { "Actinolite",              1.618 },
    { "Agalmatoite",             1.550 },
    { "Agate",                   1.544 },
    { "Agate, Moss",             1.540 },
    { "Air",                     1.0002926 },
    { "Alcohol",                 1.329 },
    { "Alexandrite",             1.745 },
    { "Aluminum",                1.44  },
    { "Amber",                   1.546 },
    { "Amblygonite",             1.611 },
    { "Amethyst",                1.544 },
    { "Anatase",                 2.490 },
    { "Andalusite",              1.641 },
    { "Anhydrite",               1.571 },
    { "Apatite",                 1.632 },
    { "Apophyllite",             1.536 },
    { "Aquamarine",              1.577 },
    { "Aragonite",               1.530 },
    { "Argon",                   1.000281 },
    { "Asphalt",                 1.635 },
    { "Augelite",                1.574 },
    { "Axinite",                 1.675 },
    { "Azurite",                 1.730 },
    { "Barite",                  1.636 },
    { "Barytocalcite",           1.684 },
    { "Benitoite",               1.757 },
    { "Benzene",                 1.501 },
    { "Beryl",                   1.577 },
    { "Beryllonite",             1.553 },
    { "Brazilianite",            1.603 },
    { "Bromine (liq)",           1.661 },
    { "Bronze",                  1.18  },
    { "Brownite",                1.567 },
    { "Calcite",                 1.486 },
    { "Calspar",                 1.486 },
    { "Cancrinite",              1.491 },
    { "Carbon Dioxide (gas)",    1.000449 },
    { "Carbon Disulfide",        1.628 },
    { "Carbon Tetrachloride",    1.460 },
    { "Cassiterite",             1.997 },
    { "Celestite",               1.622 },
    { "Cerussite",               1.804 },
    { "Ceylanite",               1.770 },
    { "Chalcedony",              1.530 },
    { "Chalk",                   1.510 },
    { "Chalybite",               1.630 },
    { "Chrome Green",            2.4   },
    { "Chrome Red",              2.42  },
    { "Chrome Yellow",           2.31  },
    { "Chromium",                2.97  },
    { "Chrysoberyl",             1.745 },
    { "Chrysocolla",             1.500 },
    { "Chrysoprase",             1.534 },
    { "Citrine",                 1.550 },
    { "Clinozoisite",            1.724 },
    { "Cobalt Blue",             1.74  },
    { "Cobalt Green",            1.97  },
    { "Cobalt Violet",           1.71  },
    { "Colemanite",              1.586 },
    { "Copper",                  1.10  },
    { "Copper Oxide",            2.705 },
    { "Coral",                   1.486 },
    { "Cordierite",              1.540 },
    { "Corundum",                1.766 },
    { "Crocoite",                2.310 },
    { "Crystal",                 2.00  },
    { "Cuprite",                 2.850 },
    { "Danburite",               1.633 },
    { "Diamond",                 2.417 },
    { "Diopside",                1.680 },
    { "Dolomite",                1.503 },
    { "Dumortierite",            1.686 },
    { "Ebonite",                 1.66  },
    { "Ekanite",                 1.600 },
    { "Elaeolite",               1.532 },
    { "Emerald",                 1.576 },
    { "Emerald, Synth flux",     1.561 },
    { "Emerald, Synth hydro",    1.568 },
    { "Enstatite",               1.663 },
    { "Epidote",                 1.733 },
    { "Ethanol",                 1.36  },
    { "Ethyl Alcohol",           1.36  },
    { "Euclase",                 1.652 },
    { "Fabulite",                2.409 },
    { "Feldspar, Adventurine",   1.532 },
    { "Feldspar, Albite",        1.525 },
    { "Feldspar, Amazonite",     1.525 },
    { "Feldspar, Labradorite",   1.565 },
    { "Feldspar, Microcline",    1.525 },
    { "Feldspar, Oligoclase",    1.539 },
    { "Feldspar, Orthoclase",    1.525 },
    { "Fluoride",                1.56  },
    { "Fluorite",                1.434 },
    { "Formica",                 1.47  },
    { "Garnet, Almandine",       1.760 },
    { "Garnet, Almandite",       1.790 },
    { "Garnet, Andradite",       1.820 },
    { "Garnet, Demantoid",       1.880 },
    { "Garnet, Grossular",       1.738 },
    { "Garnet, Hessonite",       1.745 },
    { "Garnet, Rhodolite",       1.760 },
    { "Garnet, Spessartite",     1.810 },
    { "Gaylussite",              1.517 },
    { "Glass",                   1.51714 },
    { "Glass, Albite",           1.4890 },
    { "Glass, Crown",            1.520 },
    { "Glass, Crown, Zinc",      1.517 },
    { "Glass, Flint, Dense",     1.66  },
    { "Glass, Flint, Heaviest",  1.89  },
    { "Glass, Flint, Heavy",     1.65548 },
    { "Glass, Flint, Lanthanum", 1.80  },
    { "Glass, Flint, Light",     1.58038 },
    { "Glass, Flint, Medium",    1.62725 },
    { "Glycerine",               1.473 },
    { "Gold",                    0.47  },
    { "Hambergite",              1.559 },
    { "Hauynite",                1.502 },
    { "Helium",                  1.000036 },
    { "Hematite",                2.940 },
    { "Hemimorphite",            1.614 },
    { "Hiddenite",               1.655 },
    { "Howlite",                 1.586 },
    { "Hypersthene",             1.670 },
    { "Ice",                     1.309 },
    { "Idocrase",                1.713 },
    { "Iodine Crystal",          3.34  },
    { "Iolite",                  1.548 },
    { "Iron",                    1.51  },
    { "Ivory",                   1.540 },
    { "Jade, Nephrite",          1.610 },
    { "Jadeite",                 1.665 },
    { "Jasper",                  1.540 },
    { "Jet",                     1.660 },
    { "Kornerupine",             1.665 },
    { "Kunzite",                 1.655 },
    { "Kyanite",                 1.715 },
    { "Lapis Gem",               1.500 },
    { "Lapis Lazuli",            1.61  },
    { "Lazulite",                1.615 },
    { "Lead",                    2.01  },
    { "Leucite",                 1.509 },
    { "Magnesite",               1.515 },
    { "Malachite",               1.655 },
    { "Meerschaum",              1.530 },
    { "Mercury (liq)",           1.62  },
    { "Methanol",                1.329 },
    { "Moldavite",               1.500 },
    { "Moonstone, Adularia",     1.525 },
    { "Moonstone, Albite",       1.535 },
    { "Natrolite",               1.480 },
    { "Nephrite",                1.600 },
    { "Nitrogen (gas)",          1.000297 },
    { "Nitrogen (liq)",          1.2053 },
    { "Nylon",                   1.53  },
    { "Obsidian",                1.489 },
    { "Olivine",                 1.670 },
    { "Onyx",                    1.486 },
    { "Opal",                    1.450 },
    { "Oxygen (gas)",            1.000276 },
    { "Oxygen (liq)",            1.221 },
    { "Painite",                 1.787 },
    { "Pearl",                   1.530 },
    { "Periclase",               1.740 },
    { "Peridot",                 1.654 },
    { "Peristerite",             1.525 },
    { "Petalite",                1.502 },
    { "Phenakite",               1.650 },
    { "Phosgenite",              2.117 },
    { "Plastic",                 1.460 },
    { "Plexiglas",               1.50  },
    { "Polystyrene",             1.55  },
    { "Prase",                   1.540 },
    { "Prasiolite",              1.540 },
    { "Prehnite",                1.610 },
    { "Proustite",               2.790 },
    { "Purpurite",               1.840 },
    { "Pyrite",                  1.810 },
    { "Pyrope",                  1.740 },
    { "Quartz",                  1.544 },
    { "Quartz, Fused",           1.45843 },
    { "Rhodizite",               1.690 },
    { "Rhodochrisite",           1.600 },
    { "Rhodonite",               1.735 },
    { "Rock Salt",               1.544 },
    { "Rubber, Natural",         1.5191 },
    { "Ruby",                    1.760 },
    { "Rutile",                  2.62  },
    { "Sanidine",                1.522 },
    { "Sapphire",                1.760 },
    { "Scapolite",               1.540 },
    { "Scapolite, Yellow",       1.555 },
    { "Scheelite",               1.920 },
    { "Selenium, Amorphous",     2.92  },
    { "Serpentine",              1.560 },
    { "Shell",                   1.530 },
    { "Silicon",                 4.24  },
    { "Sillimanite",             1.658 },
    { "Silver",                  0.18  },
    { "Sinhalite",               1.699 },
    { "Smaragdite",              1.608 },
    { "Smithsonite",             1.621 },
    { "Sodalite",                1.483 },
    { "Sodium Chloride",         1.544 },
    { "Sphalerite",              2.368 },
    { "Sphene",                  1.885 },
    { "Spinel",                  1.712 },
    { "Spodumene",               1.650 },
    { "Staurolite",              1.739 },
    { "Steatite",                1.539 },
    { "Steel",                   2.50  },
    { "Stichtite",               1.520 },
    { "Strontium Titanate",      2.410 },
    { "Styrofoam",               1.595 },
    { "Sulphur",                 1.960 },
    { "Synthetic Spinel",        1.730 },
    { "Taaffeite",               1.720 },
    { "Tantalite",               2.240 },
    { "Tanzanite",               1.691 },
    { "Teflon",                  1.35  },
    { "Thomsonite",              1.530 },
    { "Tiger eye",               1.544 },
    { "Topaz",                   1.620 },
    { "Topaz, Blue",             1.610 },
    { "Topaz, Pink",             1.620 },
    { "Topaz, White",            1.630 },
    { "Topaz, Yellow",           1.620 },
    { "Tourmaline",              1.624 },
    { "Tremolite",               1.600 },
    { "Tugtupite",               1.496 },
    { "Turpentine",              1.472 },
    { "Turquoise",               1.610 },
    { "Ulexite",                 1.490 },
    { "Uvarovite",               1.870 },
    { "Variscite",               1.550 },
    { "Vivianite",               1.580 },
    { "Wardite",                 1.590 },
    { "Water",                   1.33157 },
    { "Willemite",               1.690 },
    { "Witherite",               1.532 },
    { "Wulfenite",               2.300 },
    { "Zincite",                 2.010 },
    { "Zircon, High",            1.960 },
    { "Zircon, Low",             1.800 },
    { "Zirconia, Cubic",         2.170 }
};

bool g_ior_initialized = false;

std::map<std::string, float> known_iors_cache;

std::string to_upper(const std::string& s)
{
    std::locale loc;
    std::string res;
    for (size_t i = 0; i < s.length(); ++i)
        res += std::toupper(s[i], loc);
    return res;
}

void init_ior_cache()
{
    for (auto& entry : known_iors)
        known_iors_cache[to_upper(entry.first)] = entry.second;
    g_ior_initialized = true;
}

} // anonymous namespace

float get_known_ior(const std::string& material, std::string& msg)
{
    if (!g_ior_initialized)
        init_ior_cache();

    auto iter = known_iors_cache.find(to_upper(material));
    if (iter != known_iors_cache.end())
    {
        msg = "";
        return iter->second;
    }

    msg = "Unknown material name " + material + "; try specifying the IOR manually";
    return -1.0f;
}

} } // namespace eclipse::material
